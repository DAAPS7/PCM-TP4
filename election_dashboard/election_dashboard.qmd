---
title: "Eleições Legislativas 2025"
format: 
  dashboard:
    orientation: columns
    scrolling: true
    page-layout: none
---

```{ojs}
data = FileAttachment("data/ContinenteDistritos_geo.geojson").json()
tbl = FileAttachment("data/Legislativas1.json").json()

html `<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />`

mapDiv = html `<div style="height: 400px;"></div>`

map = L.map(mapDiv, {
  zoomControl: false,
  dragging: false,
  scrollWheelZoom: false
});

L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);

distritos = L.geoJSON(data, {
  style: { color: "#4b4b4bff", fillOpacity: 0.2 },
  onEachFeature: (feat, layer) => {
    layer.bindTooltip(feat.properties.Distrito, { sticky: true });
  }
}).addTo(map);

map.fitBounds(distritos.getBounds());

mapDiv;
```

```{ojs}
function getPartidos() {
  return Object.keys(tbl).filter(partido => 
    partido !== "Inscritos" && partido !== "Votantes" && partido !== "Abstenção" && partido !== "Brancos" && partido !== "Nulos" && partido !== "Votos Val. Exp. (VVE)"
  );
}

viewof selectedPartido = Inputs.select(getPartidos(), {
  label: "Selecionar Partido"
});

function partyVotesByDistrict(partido) {
  const result = [];
  const dadosPartido = tbl[partido];

  for (const [Distrito, Votos] of Object.entries(dadosPartido)) {
    result.push({ Distrito, Votos });
  }

  return result;
}

Plot.plot({
  title: `Votos por Distrito para o partido: ${selectedPartido}`,
  marks: [
    Plot.barY(partyVotesByDistrict(selectedPartido), {
      x: "Distrito",
      y: "Votos",
    }),
  ],
  width: 1200,
  height: 300
})
```